# OpenGL ES 着色器与光照计算

## 光照基础

#### 光照类型

- 环境光照
- 漫反射光照
- 镜面光照

#### 光照特性

- 发射光：由物体自身发光
- 环境光：就是在环境中充分散射的光，而且无法分辨它的方向
- 漫反射光：光线来自某个方向，但在物体上各个方向反射
- 镜面高光：光线来自一个特定的方向，然后在物体表面上以一个特定的方向反射出去

#### 材质属性

- 泛射材质
- 漫反射材质
- 镜面反射材质
- 发射材质

## 光照计算

#### 环境光的计算
$$
环境光 = 光源的环境光颜色 * 物体的材质颜色
$$

#### 发射光的计算
$$
发射颜色 = 物体的反射材质颜色
$$

#### 漫反射光照计算
$$
漫反射颜色 = 光源到漫反射颜色 * 物体的漫反射材质颜色 * DiffuseFactor
$$

$$
DiffuseFactor = max(0, dot(N, L))
$$

漫反射因子 DiffuseFactor 是 光线 和 顶点法线向量 的点积。

#### 镜面光计算
$$
镜面反射颜色 = 光源的镜面光的颜色 * 物体的镜面材质颜色 * SpecularFactor
$$

$$
SpecularFactor = power(max(0, dot(N, H)), shininess)
$$

H：视线向量E 与 光线向量L 的法向量；
dot(N,H)：H，N的点积几何意义，平分线与法线夹角的cos值；
shiniess：高光的反光度；

#### 光照计算
$$
光照颜色 = （环境颜色 + 漫反射颜色 + 镜面反色颜色）* 衰减因子
$$

##### 衰减因子
$$
F_{att} = { 1.0 \over { K_c + K_l * d + K_q * d^2 }}
$$

$$
衰减因子 = 1.0 / ( 距离衰减常量 + 线性衰减常量 * 距离 + 二次衰减常量* 距离的平方 )
$$

##### 聚光灯因子
$$
聚光灯夹角cos值 = power ( max ( 0, dot( 单位光源位置，单位光线向量 ) )，聚光灯指数 )
$$

##### 增加过渡计算
$$
聚光灯因子 = clamp((外环的聚光灯角度cos值 - 当前顶点的聚光灯角度cos值)/(外环的聚光灯角度cos值 - 内环的聚光灯角度cos值)，0，1)
$$

#### 关照计算终极公式

$$
光照颜色 = 发射颜色 + 全局环境颜色 + (环境颜色 + 漫反射颜色 + 镜面反射颜色) * 聚光灯效果 * 衰减因子
$$









